
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Generating a Scatter Plot from a Buildup with a Curve Overlaid with Calculated Mmax, M0 and T1 Parameters</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-12-07"><meta name="DC.source" content="expregress.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Generating a Scatter Plot from a Buildup with a Curve Overlaid with Calculated Mmax, M0 and T1 Parameters</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Inputs</a></li><li><a href="#5">Alternative Inputs</a></li><li><a href="#14">Output</a></li><li><a href="#16">Child Function</a></li><li><a href="#18">Verifying <i>x</i> and <i>y</i> Exist and are Valid</a></li><li><a href="#19">Generating <i>x</i> and <i>y</i> if Invalid or Non-Existent and Calculating <i>T1</i>, <i>Mmax</i>, <i>M0</i> and <i>Rsquared</i></a></li><li><a href="#20">Verifying Data is Labelled</a></li><li><a href="#21">Displaying the Equation for the Fitted Exponential Curve</a></li><li><a href="#22">Setting the Title of the Figure</a></li><li><a href="#23">Generating a Scatter Plot of the Buildup Data with Fitted Curve</a></li><li><a href="#25">Notes</a></li></ul></div><h2 id="1">Inputs</h2><p><i>x</i>: is a column vector containing the times each measurement was taken</p><p><i>y</i>: is an array containing the signal strength at each time measured. Values for different peaks go in different columns</p><p><i>peaknames</i>: is a cell containing the names of each NMR peak measured</p><p><i>titl</i>: is the title of the scatter plot (character vector)</p><h2 id="5">Alternative Inputs</h2><p><i>sys</i>: is 'Y' if the data was collected using the Alpha System or 'N' if the data was collected using the Hypersense</p><p><i>dat</i>: depending on how the data was collected, <i>dat</i> is:</p><p>a cell containing the .txt output of AMARES (Alpha System)</p><p>a .csv output file using the custom integration output using counts and values comma delimited from MestReNova (Alpha System)</p><p>a .dat file outputted from using the Hypersense containing comma delimited data</p><p><i>proc</i>: is the procpar file, which is used to find the times measured (Alpha System only)</p><p><i>inp</i>: is 'A' if the data was processed with JMRUI AMARES or is 'M' if the data was processed using MestReNova (Alpha System only)</p><p><i>coilnum</i>: if the data was processed using MestReNova, it is the number of coils used to collect the data</p><p><i>field</i>: is a cell containing the names of the peaks from which data was collected if the data was processed using MestReNova</p><h2 id="14">Output</h2><p>A scatter plot of the buildup data with a curve overlaid obeying the following relation:</p><p><img src="expregress_eq03225215471507162027.png" alt="$$ Signal Strength = Mmax + (M0 - Mmax) \times exp(-\frac{t}{T1}) $$" style="width:274px;height:22px;"></p><h2 id="16">Child Function</h2><p><i>BuildupParamCalc</i>: Calculates <i>T1</i>, <i>Mmax</i> and <i>M0</i> from the buildup data. It also calculates the coefficient of determination (<i>CODs</i>) from the fit of the calculated parameters and if <i>x</i> and <i>y</i> were not inputted/were invalid, it yields <i>x</i> and <i>y</i> too</p><pre class="codeinput"><span class="keyword">function</span> expregress(x,y,peaknames,titl,sys,dat,proc,inp,coilnum,field)
</pre><pre class="codeinput">    boolxy = 1;
</pre><h2 id="18">Verifying <i>x</i> and <i>y</i> Exist and are Valid</h2><p><i>x</i> and <i>y</i> must both be populated arrays that contain the same number of rows</p><pre class="codeinput">    <span class="keyword">if</span> nargin &lt; 2
        boolxy = 0;
    <span class="keyword">elseif</span> isempty(x) == 1
        boolxy = 0;
    <span class="keyword">elseif</span> isempty(y) == 1
        boolxy = 0;
    <span class="keyword">elseif</span> length(x) ~= length(y)
        boolxy = 0;
    <span class="keyword">end</span>
</pre><h2 id="19">Generating <i>x</i> and <i>y</i> if Invalid or Non-Existent and Calculating <i>T1</i>, <i>Mmax</i>, <i>M0</i> and <i>Rsquared</i></h2><pre class="codeinput">    <span class="keyword">if</span> boolxy == 0
        <span class="keyword">if</span> nargin == 10
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc,inp,coilnum,field);
        <span class="keyword">elseif</span> nargin == 9
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc,inp,coilnum);
        <span class="keyword">elseif</span> nargin == 8
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc,inp);
        <span class="keyword">elseif</span> nargin == 7
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc);
        <span class="keyword">elseif</span> nargin == 6
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat);
        <span class="keyword">elseif</span> nargin == 5
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys);
        <span class="keyword">else</span>
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc;
        <span class="keyword">end</span>
    <span class="keyword">else</span>
        [T1,Mmax,M0,CODs] = BuildupParamCalc(x,y);
    <span class="keyword">end</span>
</pre><pre class="codeoutput">
Local minimum possible.

lsqcurvefit stopped because the final change in the sum of squares relative to 
its initial value is less than the value of the function tolerance.

</pre><h2 id="20">Verifying Data is Labelled</h2><p>The <i>peaknames</i> variable contains the names of the data collected (the names of the peaks) from the buildup experiment. If the variable is invalid or not inputted, it is by default, set to 'Data'.</p><pre class="codeinput">    <span class="keyword">if</span> nargin &lt; 3
        peaknames = {<span class="string">'Data'</span>};
    <span class="keyword">elseif</span> string(class(peaknames)) ~= <span class="string">"cell"</span>
        peaknames = {<span class="string">'Data'</span>};
    <span class="keyword">end</span>

    numpeak = length(y(1,:));

    equ = cell(numpeak,1);
</pre><h2 id="21">Displaying the Equation for the Fitted Exponential Curve</h2><p>The parameters calcualted from <i>BuildupParamCalc</i> are used to generate the full equation describing the exponential curve, which will later be displayed on the plotted curve.</p><pre class="codeinput">    <span class="keyword">for</span> el = 1:numpeak
        sMmax = num2str(Mmax(el));
        sM0 = num2str(M0(el));
        sT1 = num2str(T1(el));
        equ{el} = strcat(<span class="string">'Signal Strength ='</span>, {<span class="string">' '</span>}, sMmax, {<span class="string">' '</span>}, <span class="string">'+ ['</span>, sM0, {<span class="string">' '</span>}, <span class="string">'-'</span>, {<span class="string">' '</span>}, sMmax, <span class="string">']exp(-time/'</span>, sT1, <span class="string">'s)'</span>);
    <span class="keyword">end</span>
</pre><h2 id="22">Setting the Title of the Figure</h2><p>If no title is given, a default title is given</p><pre class="codeinput">    <span class="keyword">if</span> nargin &lt; 4
        titl = <span class="string">'Signal Strength vs. Time'</span>;
    <span class="keyword">elseif</span> ischarvec(titl) ~= 1
        titl = <span class="string">'Signal Strength vs. Time'</span>;
    <span class="keyword">end</span>
</pre><h2 id="23">Generating a Scatter Plot of the Buildup Data with Fitted Curve</h2><pre class="codeinput">    figure(<span class="string">'Position'</span>,[0 0 600 450])
    scatter(x,y(:,1))
    hold <span class="string">on</span>
    inter = max(x)*0.01;
    x1 = 0:inter:max(x);
    y1 = Mmax(1) + (M0(1)-Mmax(1)).*exp(-x1./T1(1));

    <span class="keyword">if</span> numpeak == 1
        plot(x1,y1,<span class="string">'k'</span>)
    <span class="keyword">else</span>
        plot(x1,y1)
    <span class="keyword">end</span>

    <span class="keyword">if</span> numpeak &gt; 1
        <span class="keyword">for</span> el = 2:numpeak
            scatter(x,y(:,el))
            y1 = Mmax(el) + (M0(el)-Mmax(el)).*exp(-x1./T1(el));
            plot(x1,y1)
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    legpeaks = cell(2*numpeak,1);

    <span class="keyword">for</span> el = 1:2:(2*numpeak)
        legpeaks{el} = peaknames{el};
        legpeaks{el+1} = char(strcat(equ{el}, {<span class="string">', '</span>}, <span class="string">'Rsquared ='</span>, {<span class="string">' '</span>}, num2str(CODs(el))));
    <span class="keyword">end</span>

    legend(legpeaks,<span class="string">'Location'</span>,<span class="string">'southeast'</span>)

    xlabel(<span class="string">'Time /s'</span>)
    ylabel(<span class="string">'Signal Strength /Arbitrary Units'</span>)

    title(titl)
</pre><img vspace="5" hspace="5" src="expregress_01.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="25">Notes</h2><p>The inputs used in the example are:</p><p><i>x</i>: []</p><p><i>y</i>: []</p><p><i>peaknames</i>: []</p><p><i>titl</i>: 'Buildup of Urea using 1mM Bis Gd with OHOH Ligand 6/12/19'</p><p><i>sys</i>: 'Y'</p><p><i>dat</i>: {'BuildupUreaOHOH_06_12_19_2_2.txt'}</p><p><i>proc</i>: 'procpar06_12_19_Buildup2_1'</p><p><i>inp</i>: 'A'</p><p>The example was run by putting:</p><p>expregress([],[],[],'Buildup of Urea using 1mM Bis Gd with OHOH Ligand 6/12/19','Y',{'BuildupUreaOHOH_06_12_19_2_2.txt'},'procpar06_12_19_Buildup2_1','A')</p><p>into the command window</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Generating a Scatter Plot from a Buildup with a Curve Overlaid with Calculated Mmax, M0 and T1 Parameters
%%
%% Inputs
% _x_: is a column vector containing the times each measurement was taken
%%
% _y_: is an array containing the signal strength at each time measured.
% Values for different peaks go in different columns
%%
% _peaknames_: is a cell containing the names of each NMR peak measured
%%
% _titl_: is the title of the scatter plot (character vector)
%% Alternative Inputs
% _sys_: is 'Y' if the data was collected using the Alpha System or 'N' if
% the data was collected using the Hypersense
%%
% _dat_: depending on how the data was collected, _dat_ is:
%%
% a cell containing the .txt output of AMARES (Alpha System)
%%
% a .csv output file using the custom integration output using counts and
% values comma delimited from MestReNova (Alpha System)
%%
% a .dat file outputted from using the Hypersense containing comma
% delimited data
%%
% _proc_: is the procpar file, which is used to find the times measured
% (Alpha System only)
%%
% _inp_: is 'A' if the data was processed with JMRUI AMARES or is 'M' if
% the data was processed using MestReNova (Alpha System only)
%%
% _coilnum_: if the data was processed using MestReNova, it is the number
% of coils used to collect the data
%%
% _field_: is a cell containing the names of the peaks from which data was
% collected if the data was processed using MestReNova
%% Output
% A scatter plot of the buildup data with a curve overlaid obeying the
% following relation:
%%
% $$ Signal Strength = Mmax + (M0 - Mmax) \times exp(-\frac{t}{T1}) $$
%% Child Function
% _BuildupParamCalc_: Calculates _T1_, _Mmax_ and _M0_ from the buildup
% data. It also calculates the coefficient of determination (_CODs_) from
% the fit of the calculated parameters and if _x_ and _y_ were not
% inputted/were invalid, it yields _x_ and _y_ too

function expregress(x,y,peaknames,titl,sys,dat,proc,inp,coilnum,field)

    boolxy = 1;
    
    %% Verifying _x_ and _y_ Exist and are Valid
    % _x_ and _y_ must both be populated arrays that contain the same
    % number of rows
    
    if nargin < 2
        boolxy = 0;
    elseif isempty(x) == 1
        boolxy = 0;
    elseif isempty(y) == 1
        boolxy = 0;
    elseif length(x) ~= length(y)
        boolxy = 0;
    end
   
    
    %% Generating _x_ and _y_ if Invalid or Non-Existent and Calculating _T1_, _Mmax_, _M0_ and _Rsquared_
    
    if boolxy == 0
        if nargin == 10
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc,inp,coilnum,field);
        elseif nargin == 9
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc,inp,coilnum);
        elseif nargin == 8
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc,inp);
        elseif nargin == 7
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat,proc);
        elseif nargin == 6
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys,dat);
        elseif nargin == 5
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc([],[],sys);
        else
            [T1,Mmax,M0,CODs,x,y] = BuildupParamCalc;
        end
    else
        [T1,Mmax,M0,CODs] = BuildupParamCalc(x,y);
    end
    
    %% Verifying Data is Labelled
    % The _peaknames_ variable contains the names of the data collected
    % (the names of the peaks) from the buildup experiment. If the variable
    % is invalid or not inputted, it is by default, set to 'Data'.
    
    if nargin < 3
        peaknames = {'Data'};
    elseif string(class(peaknames)) ~= "cell"
        peaknames = {'Data'};
    end

    numpeak = length(y(1,:));
    
    equ = cell(numpeak,1);
    
    %% Displaying the Equation for the Fitted Exponential Curve
    % The parameters calcualted from _BuildupParamCalc_ are used to
    % generate the full equation describing the exponential curve, which
    % will later be displayed on the plotted curve.
    
    for el = 1:numpeak
        sMmax = num2str(Mmax(el));
        sM0 = num2str(M0(el));
        sT1 = num2str(T1(el));
        equ{el} = strcat('Signal Strength =', {' '}, sMmax, {' '}, '+ [', sM0, {' '}, '-', {' '}, sMmax, ']exp(-time/', sT1, 's)');
    end

    %% Setting the Title of the Figure
    % If no title is given, a default title is given
    
    if nargin < 4
        titl = 'Signal Strength vs. Time';
    elseif ischarvec(titl) ~= 1
        titl = 'Signal Strength vs. Time';
    end
    
    %% Generating a Scatter Plot of the Buildup Data with Fitted Curve
    
    figure('Position',[0 0 600 450])
    scatter(x,y(:,1))
    hold on
    inter = max(x)*0.01;
    x1 = 0:inter:max(x);
    y1 = Mmax(1) + (M0(1)-Mmax(1)).*exp(-x1./T1(1));
    
    if numpeak == 1
        plot(x1,y1,'k')
    else
        plot(x1,y1)
    end
    
    if numpeak > 1
        for el = 2:numpeak
            scatter(x,y(:,el))
            y1 = Mmax(el) + (M0(el)-Mmax(el)).*exp(-x1./T1(el));
            plot(x1,y1)
        end
    end
    
    legpeaks = cell(2*numpeak,1);
    
    for el = 1:2:(2*numpeak)
        legpeaks{el} = peaknames{el};
        legpeaks{el+1} = char(strcat(equ{el}, {', '}, 'Rsquared =', {' '}, num2str(CODs(el))));
    end
    
    legend(legpeaks,'Location','southeast')
    
    xlabel('Time /s')
    ylabel('Signal Strength /Arbitrary Units')
    
    title(titl)
    
end

%% Notes
% The inputs used in the example are:
%%
% _x_: []
%%
% _y_: []
%%
% _peaknames_: []
%%
% _titl_: 'Buildup of Urea using 1mM Bis Gd with OHOH Ligand 6/12/19'
%%
% _sys_: 'Y'
%%
% _dat_: {'BuildupUreaOHOH_06_12_19_2_2.txt'}
%%
% _proc_: 'procpar06_12_19_Buildup2_1'
%%
% _inp_: 'A'
%%
% The example was run by putting:
%%
% expregress([],[],[],'Buildup of Urea using 1mM Bis Gd with OHOH Ligand 6/12/19','Y',{'BuildupUreaOHOH_06_12_19_2_2.txt'},'procpar06_12_19_Buildup2_1','A')
%%
% into the command window
##### SOURCE END #####
--></body></html>