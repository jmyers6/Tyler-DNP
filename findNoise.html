
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Calculating the Noise from an NMR Experiment</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-12-12"><meta name="DC.source" content="findNoise.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Calculating the Noise from an NMR Experiment</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Input</a></li><li><a href="#4">Output</a></li><li><a href="#5">Child Function</a></li><li><a href="#7">Verifying the Existence and Validity of the Input</a></li><li><a href="#8">Calculating the Noise if the Input is Valid</a></li><li><a href="#10">Calling the User to Input FID files if the Input was Invalid or Missing</a></li><li><a href="#13">Notes</a></li></ul></div><p>NMR data is often described by its signal to noise (SNR) ratio. In this function, the noise of an NMR experiment is defined by the standard deviation of the last eighth of the points in the experiment's time domain. If there is more than one signal inside the inputted file, only the noise for the first signal will be calculated.</p><p>In NMR experiments, data is collected in both real and imaginary components. The noise is calculated separately for both components and then outputted as the average of the two</p><h2 id="3">Input</h2><p><i>dat</i>: is a cell containing the .txt mRUI FID files from JMRUI, where the noise is to be calculated from in each element</p><h2 id="4">Output</h2><p><i>noise</i>: is an array containing the calculated noise for each inputted FID file in each element</p><h2 id="5">Child Function</h2><p><i>numofMeasurements</i>: returns the number of measurements taken per signal for a .txt mRUI FID file from JMRUI</p><pre class="codeinput"><span class="keyword">function</span> noise = findNoise(dat)
</pre><pre class="codeinput">    cont = 0;
</pre><h2 id="7">Verifying the Existence and Validity of the Input</h2><pre class="codeinput">    <span class="keyword">if</span> nargin == 1
        <span class="keyword">if</span> string(class(dat)) == <span class="string">"cell"</span>
            cont = 1;
            <span class="keyword">try</span>
                readmatrix(dat{1});
            <span class="keyword">catch</span>
                disp(<span class="string">'Invalid files entered'</span>)
                cont = 0;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><h2 id="8">Calculating the Noise if the Input is Valid</h2><p>The number of noise parameters calculated is equal to the number of files inputted. The standard deviation is taken along the last eighth of the points in the time domain of both the real and imaginary parts of the data. The final calculated noise is the mean of those two values</p><pre class="codeinput">    <span class="keyword">if</span> cont == 1

        numEnt = length(dat);
        pointsPerSig = numofMeasurements(dat{1});
        noisesVar = zeros(numEnt,1);

        <span class="keyword">for</span> el = 1:numEnt
            FIDa = readmatrix(dat{el});

            FID = FIDa(1:pointsPerSig,1:2);

            rows = length(FID(:,1));

            lastEighth = floor(rows/8);

            noises = std(FID(end-lastEighth:end,:));

            noisesVar(el) = mean(noises);
        <span class="keyword">end</span>

    <span class="keyword">else</span>
</pre><h2 id="10">Calling the User to Input FID files if the Input was Invalid or Missing</h2><p>The user is called to enter a FID file, where the noise is calculated as described above. The user can then enter additional FID files, where the noise is appended to the previously calcualted ones until the user terminates input by typing 'N' when prompted</p><pre class="codeinput">        datn = input(<span class="string">'Enter the .txt file containing the FID: '</span>,<span class="string">'s'</span>);
        FIDa = readmatrix(datn);
        pointsPerSig = numofMeasurements(datn);
        FID = FIDa(1:pointsPerSig,1:2);
        rows = length(FID(:,1));
        lastEighth = floor(rows/8);
        noises = std(FID(end-lastEighth:end,:));
        noisesVar = mean(noises);
        bool = 0;

        <span class="keyword">while</span> bool == 0

            inp = input(<span class="string">'Is there data from another coil to process? (Y/N): '</span>,<span class="string">'s'</span>);
            bool = checkYN(inp);

            <span class="keyword">if</span> bool == 0
                disp(<span class="string">'Error: Enter Y or N to signify whether to process another set of FID data'</span>)
            <span class="keyword">end</span>

        <span class="keyword">end</span>

        <span class="keyword">while</span> bool == 1

            datn = input(<span class="string">'Enter the next .txt file containing the FID: '</span>,<span class="string">'s'</span>);
            FIDa = readmatrix(datn);
            pointsPerSig = numofMeasurements(dat{1});
            FID = FIDa(1:pointsPerSig,1:2);
            rows = length(FID(:,1));
            lastEighth = floor(rows/8);
            noises = std(FID(end-lastEighth:end,:));
            noisesVar = [noisesVar; mean(noises)];
            inp = input(<span class="string">'Is there data from another coil to process? (Y/N): '</span>,<span class="string">'s'</span>);
            bool = checkYN(inp);

            <span class="keyword">while</span> bool == 0
                disp(<span class="string">'Error: Enter Y or N to signify whether to process another set of FID data'</span>)
                inp = input(<span class="string">'Is there data from another coil to process? (Y/N): '</span>,<span class="string">'s'</span>);
                bool = checkYN(inp);
            <span class="keyword">end</span>

        <span class="keyword">end</span>
</pre><pre class="codeinput">    <span class="keyword">end</span>

    noise = noisesVar;
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
noise =

    1.6759
   13.2595

</pre><h2 id="13">Notes</h2><p>The input used in the example was:</p><p><i>dat</i>: {'Decay_DissolutionFID_1Pyr_09_12_19.txt','ThermalFID_1Pyr_10_12_19.txt'}</p><p>The example was run by putting:</p><p>noise = findNoise({'Decay_DissolutionFID_1Pyr_09_12_19.txt','ThermalFID_1Pyr_10_12_19.txt'})</p><p>into the command window</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Calculating the Noise from an NMR Experiment
%%
% NMR data is often described by its signal to noise (SNR) ratio. In this
% function, the noise of an NMR experiment is defined by the standard
% deviation of the last eighth of the points in the experiment's time
% domain. If there is more than one signal inside the inputted file, only
% the noise for the first signal will be calculated.
%%
% In NMR experiments, data is collected in both real and imaginary
% components. The noise is calculated separately for both components and
% then outputted as the average of the two
%% Input
% _dat_: is a cell containing the .txt mRUI FID files from JMRUI, where 
% the noise is to be calculated from in each element
%% Output
% _noise_: is an array containing the calculated noise for each inputted
% FID file in each element
%% Child Function
% _numofMeasurements_: returns the number of measurements taken per signal
% for a .txt mRUI FID file from JMRUI

function noise = findNoise(dat)

    cont = 0;
    
    %% Verifying the Existence and Validity of the Input

    if nargin == 1
        if string(class(dat)) == "cell"
            cont = 1;
            try
                readmatrix(dat{1});
            catch
                disp('Invalid files entered')
                cont = 0;
            end
        end
    end
    
    %% Calculating the Noise if the Input is Valid
    % The number of noise parameters calculated is equal to the number of
    % files inputted. The standard deviation is taken along the last eighth
    % of the points in the time domain of both the real and imaginary parts
    % of the data. The final calculated noise is the mean of those two
    % values
    
    if cont == 1
        
        numEnt = length(dat);
        pointsPerSig = numofMeasurements(dat{1});
        noisesVar = zeros(numEnt,1);
        
        for el = 1:numEnt
            FIDa = readmatrix(dat{el});
    
            FID = FIDa(1:pointsPerSig,1:2);
    
            rows = length(FID(:,1));
    
            lastEighth = floor(rows/8);
    
            noises = std(FID(end-lastEighth:end,:));
    
            noisesVar(el) = mean(noises);
        end
        
    else
        
        %% Calling the User to Input FID files if the Input was Invalid or Missing
        % The user is called to enter a FID file, where the noise is
        % calculated as described above. The user can then enter additional
        % FID files, where the noise is appended to the previously
        % calcualted ones until the user terminates input by typing 'N'
        % when prompted
        
        datn = input('Enter the .txt file containing the FID: ','s');
        FIDa = readmatrix(datn);
        pointsPerSig = numofMeasurements(datn);
        FID = FIDa(1:pointsPerSig,1:2);
        rows = length(FID(:,1));
        lastEighth = floor(rows/8);
        noises = std(FID(end-lastEighth:end,:));
        noisesVar = mean(noises);
        bool = 0;
        
        while bool == 0
            
            inp = input('Is there data from another coil to process? (Y/N): ','s');
            bool = checkYN(inp);
            
            if bool == 0
                disp('Error: Enter Y or N to signify whether to process another set of FID data')
            end
            
        end
        
        while bool == 1
            
            datn = input('Enter the next .txt file containing the FID: ','s');
            FIDa = readmatrix(datn);
            pointsPerSig = numofMeasurements(dat{1});
            FID = FIDa(1:pointsPerSig,1:2);
            rows = length(FID(:,1));
            lastEighth = floor(rows/8);
            noises = std(FID(end-lastEighth:end,:));
            noisesVar = [noisesVar; mean(noises)];
            inp = input('Is there data from another coil to process? (Y/N): ','s');
            bool = checkYN(inp);
            
            while bool == 0
                disp('Error: Enter Y or N to signify whether to process another set of FID data')
                inp = input('Is there data from another coil to process? (Y/N): ','s');
                bool = checkYN(inp);
            end
            
        end
        
    end
    
    noise = noisesVar;
    
end

%% Notes
% The input used in the example was:
%%
% _dat_: {'Decay_DissolutionFID_1Pyr_09_12_19.txt','ThermalFID_1Pyr_10_12_19.txt'}
%%
% The example was run by putting:
%%
% noise = findNoise({'Decay_DissolutionFID_1Pyr_09_12_19.txt','ThermalFID_1Pyr_10_12_19.txt'})
%%
% into the command window
##### SOURCE END #####
--></body></html>